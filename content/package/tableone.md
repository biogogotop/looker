+++
author = 'asepsiswu'
title = "tableone 用法"
#date = "2020-06-09"
date = 2020-06-09T16:44:29+08:00
archives = "2020/06" 
tags = [ "tableone" ]
summary = "tableone 2分类统计"
+++

## installation

```r
install.package('tableone')
```

## example

```r
library(tableone)
library(survival)
library(data.table)
library(openxlsx)
data(pbc)
head(pbc)
```

```
##   id time status trt      age sex ascites hepato spiders edema bili chol
## 1  1  400      2   1 58.76523   f       1      1       1   1.0 14.5  261
## 2  2 4500      0   1 56.44627   f       0      1       1   0.0  1.1  302
## 3  3 1012      2   1 70.07255   m       0      0       0   0.5  1.4  176
## 4  4 1925      2   1 54.74059   f       0      1       1   0.5  1.8  244
## 5  5 1504      1   2 38.10541   f       0      1       1   0.0  3.4  279
## 6  6 2503      2   2 66.25873   f       0      1       0   0.0  0.8  248
##   albumin copper alk.phos    ast trig platelet protime stage
## 1    2.60    156   1718.0 137.95  172      190    12.2     4
## 2    4.14     54   7394.8 113.52   88      221    10.6     3
## 3    3.48    210    516.0  96.10   55      151    12.0     4
## 4    2.54     64   6121.8  60.63   92      183    10.3     4
## 5    3.53    143    671.0 113.15   72      136    10.9     3
## 6    3.98     50    944.0  93.00   63       NA    11.0     3
```

```r
names(pbc)
```

```
##  [1] "id"       "time"     "status"   "trt"      "age"      "sex"     
##  [7] "ascites"  "hepato"   "spiders"  "edema"    "bili"     "chol"    
## [13] "albumin"  "copper"   "alk.phos" "ast"      "trig"     "platelet"
## [19] "protime"  "stage"
```

```r
dat <- pbc[,-1]
catVars <- c("status", "trt", 'sex',"ascites", "hepato", "spiders", "edema", "stage")
```


```r
tb1 <-  CreateTableOne( data = dat, factorVars = catVars)
print(tb1)
```

```
##                       
##                        Overall          
##   n                        418          
##   time (mean (SD))     1917.78 (1104.67)
##   status (%)                            
##      0                     232 (55.5)   
##      1                      25 ( 6.0)   
##      2                     161 (38.5)   
##   trt = 2 (%)              154 (49.4)   
##   age (mean (SD))        50.74 (10.45)  
##   sex = f (%)              374 (89.5)   
##   ascites = 1 (%)           24 ( 7.7)   
##   hepato = 1 (%)           160 (51.3)   
##   spiders = 1 (%)           90 (28.8)   
##   edema (%)                             
##      0                     354 (84.7)   
##      0.5                    44 (10.5)   
##      1                      20 ( 4.8)   
##   bili (mean (SD))        3.22 (4.41)   
##   chol (mean (SD))      369.51 (231.94) 
##   albumin (mean (SD))     3.50 (0.42)   
##   copper (mean (SD))     97.65 (85.61)  
##   alk.phos (mean (SD)) 1982.66 (2140.39)
##   ast (mean (SD))       122.56 (56.70)  
##   trig (mean (SD))      124.70 (65.15)  
##   platelet (mean (SD))  257.02 (98.33)  
##   protime (mean (SD))    10.73 (1.02)   
##   stage (%)                             
##      1                      21 ( 5.1)   
##      2                      92 (22.3)   
##      3                     155 (37.6)   
##      4                     144 (35.0)
```

```r
summary(tb1)
```

```
## 
##      ### Summary of continuous variables ###
## 
## strata: Overall
##            n miss p.miss mean    sd median   p25  p75   min   max  skew kurt
## time     418    0    0.0 1918 1e+03   1730 1e+03 2614  41.0  4795  0.47 -0.5
## age      418    0    0.0   51 1e+01     51 4e+01   58  26.3    78  0.09 -0.6
## bili     418    0    0.0    3 4e+00      1 8e-01    3   0.3    28  2.72  8.1
## chol     418  134   32.1  370 2e+02    310 2e+02  400 120.0  1775  3.41 14.3
## albumin  418    0    0.0    3 4e-01      4 3e+00    4   2.0     5 -0.47  0.6
## copper   418  108   25.8   98 9e+01     73 4e+01  123   4.0   588  2.30  7.6
## alk.phos 418  106   25.4 1983 2e+03   1259 9e+02 1980 289.0 13862  2.99  9.7
## ast      418  106   25.4  123 6e+01    115 8e+01  152  26.4   457  1.45  4.3
## trig     418  136   32.5  125 7e+01    108 8e+01  151  33.0   598  2.52 11.8
## platelet 418   11    2.6  257 1e+02    251 2e+02  318  62.0   721  0.63  0.9
## protime  418    2    0.5   11 1e+00     11 1e+01   11   9.0    18  2.22 10.0
## 
## =======================================================================================
## 
##      ### Summary of categorical variables ### 
## 
## strata: Overall
##      var   n miss p.miss level freq percent cum.percent
##   status 418    0    0.0     0  232    55.5        55.5
##                              1   25     6.0        61.5
##                              2  161    38.5       100.0
##                                                        
##      trt 418  106   25.4     1  158    50.6        50.6
##                              2  154    49.4       100.0
##                                                        
##      sex 418    0    0.0     m   44    10.5        10.5
##                              f  374    89.5       100.0
##                                                        
##  ascites 418  106   25.4     0  288    92.3        92.3
##                              1   24     7.7       100.0
##                                                        
##   hepato 418  106   25.4     0  152    48.7        48.7
##                              1  160    51.3       100.0
##                                                        
##  spiders 418  106   25.4     0  222    71.2        71.2
##                              1   90    28.8       100.0
##                                                        
##    edema 418    0    0.0     0  354    84.7        84.7
##                            0.5   44    10.5        95.2
##                              1   20     4.8       100.0
##                                                        
##    stage 418    6    1.4     1   21     5.1         5.1
##                              2   92    22.3        27.4
##                              3  155    37.6        65.0
##                              4  144    35.0       100.0
## 
```

```r
print(tb1,showAllLevels = T) # show all levels
```

```
##                       
##                        level Overall          
##   n                              418          
##   time (mean (SD))           1917.78 (1104.67)
##   status (%)           0         232 (55.5)   
##                        1          25 ( 6.0)   
##                        2         161 (38.5)   
##   trt (%)              1         158 (50.6)   
##                        2         154 (49.4)   
##   age (mean (SD))              50.74 (10.45)  
##   sex (%)              m          44 (10.5)   
##                        f         374 (89.5)   
##   ascites (%)          0         288 (92.3)   
##                        1          24 ( 7.7)   
##   hepato (%)           0         152 (48.7)   
##                        1         160 (51.3)   
##   spiders (%)          0         222 (71.2)   
##                        1          90 (28.8)   
##   edema (%)            0         354 (84.7)   
##                        0.5        44 (10.5)   
##                        1          20 ( 4.8)   
##   bili (mean (SD))              3.22 (4.41)   
##   chol (mean (SD))            369.51 (231.94) 
##   albumin (mean (SD))           3.50 (0.42)   
##   copper (mean (SD))           97.65 (85.61)  
##   alk.phos (mean (SD))       1982.66 (2140.39)
##   ast (mean (SD))             122.56 (56.70)  
##   trig (mean (SD))            124.70 (65.15)  
##   platelet (mean (SD))        257.02 (98.33)  
##   protime (mean (SD))          10.73 (1.02)   
##   stage (%)            1          21 ( 5.1)   
##                        2          92 (22.3)   
##                        3         155 (37.6)   
##                        4         144 (35.0)
```



```r
tb2 <- CreateTableOne( strata = "sex" , data = dat, factorVars = catVars)
tb2
```

```
##                       Stratified by sex
##                        m                 f                 p      test
##   n                         44               374                      
##   time (mean (SD))     1894.02 (1213.03) 1920.58 (1092.95)  0.880     
##   status (%)                                                0.053     
##      0                      17 (38.6)        215 ( 57.5)              
##      1                       3 ( 6.8)         22 (  5.9)              
##      2                      24 (54.5)        137 ( 36.6)              
##   trt = 2 (%)               15 (41.7)        139 ( 50.4)    0.421     
##   age (mean (SD))        55.71 (10.98)     50.16 (10.24)    0.001     
##   sex = f (%)                0 ( 0.0)        374 (100.0)   <0.001     
##   ascites = 1 (%)            3 ( 8.3)         21 (  7.6)    1.000     
##   hepato = 1 (%)            21 (58.3)        139 ( 50.4)    0.470     
##   spiders = 1 (%)            4 (11.1)         86 ( 31.2)    0.021     
##   edema (%)                                                 0.777     
##      0                      36 (81.8)        318 ( 85.0)              
##      0.5                     5 (11.4)         39 ( 10.4)              
##      1                       3 ( 6.8)         17 (  4.5)              
##   bili (mean (SD))        2.87 (2.32)       3.26 (4.59)     0.573     
##   chol (mean (SD))      362.46 (178.99)   370.50 (238.73)   0.848     
##   albumin (mean (SD))     3.54 (0.46)       3.49 (0.42)     0.536     
##   copper (mean (SD))    154.28 (100.67)    90.21 (80.74)   <0.001     
##   alk.phos (mean (SD)) 2172.95 (2418.45) 1957.83 (2105.05)  0.571     
##   ast (mean (SD))       121.99 (47.01)    122.63 (57.92)    0.949     
##   trig (mean (SD))      133.43 (52.17)    123.47 (66.78)    0.398     
##   platelet (mean (SD))  231.14 (85.23)    260.08 (99.42)    0.068     
##   protime (mean (SD))    10.94 (0.93)      10.71 (1.03)     0.151     
##   stage (%)                                                 0.831     
##      1                       3 ( 6.8)         18 (  4.9)              
##      2                       8 (18.2)         84 ( 22.8)              
##      3                      16 (36.4)        139 ( 37.8)              
##      4                      17 (38.6)        127 ( 34.5)
```

```r
needFisher <- function(dat){
  # 2分类下， 那些cell<=5 需要用fisher 检验
  lgt5 <- sapply(dat$CatTable[[1]],function(x)any(x$freq<=5)) |
    sapply(dat$CatTable[[2]],function(x)any(x$freq<=5))
  names(lgt5[lgt5])
}
fishvar <- needFisher(tb2)
print(tb2, exact = fishvar, showAllLevels = T)
```

```
##                       Stratified by sex
##                        level m                 f                 p      test 
##   n                               44               374                       
##   time (mean (SD))           1894.02 (1213.03) 1920.58 (1092.95)  0.880      
##   status (%)           0          17 ( 38.6)       215 ( 57.5)    0.042 exact
##                        1           3 (  6.8)        22 (  5.9)               
##                        2          24 ( 54.5)       137 ( 36.6)               
##   trt (%)              1          21 ( 58.3)       137 ( 49.6)    0.421      
##                        2          15 ( 41.7)       139 ( 50.4)               
##   age (mean (SD))              55.71 (10.98)     50.16 (10.24)    0.001      
##   sex (%)              m          44 (100.0)         0 (  0.0)   <0.001 exact
##                        f           0 (  0.0)       374 (100.0)               
##   ascites (%)          0          33 ( 91.7)       255 ( 92.4)    0.747 exact
##                        1           3 (  8.3)        21 (  7.6)               
##   hepato (%)           0          15 ( 41.7)       137 ( 49.6)    0.470      
##                        1          21 ( 58.3)       139 ( 50.4)               
##   spiders (%)          0          32 ( 88.9)       190 ( 68.8)    0.011 exact
##                        1           4 ( 11.1)        86 ( 31.2)               
##   edema (%)            0          36 ( 81.8)       318 ( 85.0)    0.651 exact
##                        0.5         5 ( 11.4)        39 ( 10.4)               
##                        1           3 (  6.8)        17 (  4.5)               
##   bili (mean (SD))              2.87 (2.32)       3.26 (4.59)     0.573      
##   chol (mean (SD))            362.46 (178.99)   370.50 (238.73)   0.848      
##   albumin (mean (SD))           3.54 (0.46)       3.49 (0.42)     0.536      
##   copper (mean (SD))          154.28 (100.67)    90.21 (80.74)   <0.001      
##   alk.phos (mean (SD))       2172.95 (2418.45) 1957.83 (2105.05)  0.571      
##   ast (mean (SD))             121.99 (47.01)    122.63 (57.92)    0.949      
##   trig (mean (SD))            133.43 (52.17)    123.47 (66.78)    0.398      
##   platelet (mean (SD))        231.14 (85.23)    260.08 (99.42)    0.068      
##   protime (mean (SD))          10.94 (0.93)      10.71 (1.03)     0.151      
##   stage (%)            1           3 (  6.8)        18 (  4.9)    0.777 exact
##                        2           8 ( 18.2)        84 ( 22.8)               
##                        3          16 ( 36.4)       139 ( 37.8)               
##                        4          17 ( 38.6)       127 ( 34.5)
```

```r
tb2.output <- print(tb2, exact = fishvar, showAllLevels = T,
                   quote = FALSE, noSpaces = TRUE, printToggle = FALSE)
tb2.output
```

```
##                       Stratified by sex
##                        level m                   f                   p       
##   n                    ""    "44"                "374"               ""      
##   time (mean (SD))     ""    "1894.02 (1213.03)" "1920.58 (1092.95)" "0.880" 
##   status (%)           "0"   "17 (38.6)"         "215 (57.5)"        "0.042" 
##                        "1"   "3 (6.8)"           "22 (5.9)"          ""      
##                        "2"   "24 (54.5)"         "137 (36.6)"        ""      
##   trt (%)              "1"   "21 (58.3)"         "137 (49.6)"        "0.421" 
##                        "2"   "15 (41.7)"         "139 (50.4)"        ""      
##   age (mean (SD))      ""    "55.71 (10.98)"     "50.16 (10.24)"     "0.001" 
##   sex (%)              "m"   "44 (100.0)"        "0 (0.0)"           "<0.001"
##                        "f"   "0 (0.0)"           "374 (100.0)"       ""      
##   ascites (%)          "0"   "33 (91.7)"         "255 (92.4)"        "0.747" 
##                        "1"   "3 (8.3)"           "21 (7.6)"          ""      
##   hepato (%)           "0"   "15 (41.7)"         "137 (49.6)"        "0.470" 
##                        "1"   "21 (58.3)"         "139 (50.4)"        ""      
##   spiders (%)          "0"   "32 (88.9)"         "190 (68.8)"        "0.011" 
##                        "1"   "4 (11.1)"          "86 (31.2)"         ""      
##   edema (%)            "0"   "36 (81.8)"         "318 (85.0)"        "0.651" 
##                        "0.5" "5 (11.4)"          "39 (10.4)"         ""      
##                        "1"   "3 (6.8)"           "17 (4.5)"          ""      
##   bili (mean (SD))     ""    "2.87 (2.32)"       "3.26 (4.59)"       "0.573" 
##   chol (mean (SD))     ""    "362.46 (178.99)"   "370.50 (238.73)"   "0.848" 
##   albumin (mean (SD))  ""    "3.54 (0.46)"       "3.49 (0.42)"       "0.536" 
##   copper (mean (SD))   ""    "154.28 (100.67)"   "90.21 (80.74)"     "<0.001"
##   alk.phos (mean (SD)) ""    "2172.95 (2418.45)" "1957.83 (2105.05)" "0.571" 
##   ast (mean (SD))      ""    "121.99 (47.01)"    "122.63 (57.92)"    "0.949" 
##   trig (mean (SD))     ""    "133.43 (52.17)"    "123.47 (66.78)"    "0.398" 
##   platelet (mean (SD)) ""    "231.14 (85.23)"    "260.08 (99.42)"    "0.068" 
##   protime (mean (SD))  ""    "10.94 (0.93)"      "10.71 (1.03)"      "0.151" 
##   stage (%)            "1"   "3 (6.8)"           "18 (4.9)"          "0.777" 
##                        "2"   "8 (18.2)"          "84 (22.8)"         ""      
##                        "3"   "16 (36.4)"         "139 (37.8)"        ""      
##                        "4"   "17 (38.6)"         "127 (34.5)"        ""      
##                       Stratified by sex
##                        test   
##   n                    ""     
##   time (mean (SD))     ""     
##   status (%)           "exact"
##                        ""     
##                        ""     
##   trt (%)              ""     
##                        ""     
##   age (mean (SD))      ""     
##   sex (%)              "exact"
##                        ""     
##   ascites (%)          "exact"
##                        ""     
##   hepato (%)           ""     
##                        ""     
##   spiders (%)          "exact"
##                        ""     
##   edema (%)            "exact"
##                        ""     
##                        ""     
##   bili (mean (SD))     ""     
##   chol (mean (SD))     ""     
##   albumin (mean (SD))  ""     
##   copper (mean (SD))   ""     
##   alk.phos (mean (SD)) ""     
##   ast (mean (SD))      ""     
##   trig (mean (SD))     ""     
##   platelet (mean (SD)) ""     
##   protime (mean (SD))  ""     
##   stage (%)            "exact"
##                        ""     
##                        ""     
##                        ""
```

```r
tb2.output <- data.table(tb2.output,keep.rownames = 'rowname')
# write.xlsx(tb2.output,file = 'demo.xlsx')
```
