+++
author = 'asepsiswu'
title = "数据可视化之data.table::fread 用法"
date = 2021-03-22T13:27:31+08:00
archives = "2021/03" 
tags = [ "data.table","import" ]
categories = [ "R" ]
summary = "简单介绍一种方便快速导入数据的方法"
+++
简单介绍一种方便快速导入数据的方法。
相比较与基础的 read.table， data.table::fread更加快捷。


## 基本用法：
0. 准备文件
    
    ```r
    write.csv(mtcars[1:10L,], 'mtcars.csv')
    zip('mtcars.csv.zip', 'mtcars.csv')
    system('gzip -k mtcars.csv')
    writeLines(c("1, ,3","1,B,3"),"mtcar.blank.txt")
    list.files(pattern = 'mtcar')
    ```
    
    ```
      [1] "mtcar.blank.txt" "mtcars.csv"      "mtcars.csv.gz"   "mtcars.csv.zip"
    ```

1. csv和txt文本文件 
    
    ```r
    library(data.table)
    fread('mtcars.csv') 
    ```
    
    
    
    |V1                |  mpg| cyl|  disp|  hp| drat|    wt|  qsec| vs| am| gear| carb|
    |:-----------------|----:|---:|-----:|---:|----:|-----:|-----:|--:|--:|----:|----:|
    |Mazda RX4         | 21.0|   6| 160.0| 110| 3.90| 2.620| 16.46|  0|  1|    4|    4|
    |Mazda RX4 Wag     | 21.0|   6| 160.0| 110| 3.90| 2.875| 17.02|  0|  1|    4|    4|
    |Datsun 710        | 22.8|   4| 108.0|  93| 3.85| 2.320| 18.61|  1|  1|    4|    1|
    |Hornet 4 Drive    | 21.4|   6| 258.0| 110| 3.08| 3.215| 19.44|  1|  0|    3|    1|
    |Hornet Sportabout | 18.7|   8| 360.0| 175| 3.15| 3.440| 17.02|  0|  0|    3|    2|
    |Valiant           | 18.1|   6| 225.0| 105| 2.76| 3.460| 20.22|  1|  0|    3|    1|
    |Duster 360        | 14.3|   8| 360.0| 245| 3.21| 3.570| 15.84|  0|  0|    3|    4|
    |Merc 240D         | 24.4|   4| 146.7|  62| 3.69| 3.190| 20.00|  1|  0|    4|    2|
    |Merc 230          | 22.8|   4| 140.8|  95| 3.92| 3.150| 22.90|  1|  0|    4|    2|
    |Merc 280          | 19.2|   6| 167.6| 123| 3.92| 3.440| 18.30|  1|  0|    4|    4|
2. zip gzip压缩文件
    
    ```r
    fread('unzip -cq mtcars.csv.zip') 
    ```
    
    
    
    |V1                |  mpg| cyl|  disp|  hp| drat|    wt|  qsec| vs| am| gear| carb|
    |:-----------------|----:|---:|-----:|---:|----:|-----:|-----:|--:|--:|----:|----:|
    |Mazda RX4         | 21.0|   6| 160.0| 110| 3.90| 2.620| 16.46|  0|  1|    4|    4|
    |Mazda RX4 Wag     | 21.0|   6| 160.0| 110| 3.90| 2.875| 17.02|  0|  1|    4|    4|
    |Datsun 710        | 22.8|   4| 108.0|  93| 3.85| 2.320| 18.61|  1|  1|    4|    1|
    |Hornet 4 Drive    | 21.4|   6| 258.0| 110| 3.08| 3.215| 19.44|  1|  0|    3|    1|
    |Hornet Sportabout | 18.7|   8| 360.0| 175| 3.15| 3.440| 17.02|  0|  0|    3|    2|
    |Valiant           | 18.1|   6| 225.0| 105| 2.76| 3.460| 20.22|  1|  0|    3|    1|
    |Duster 360        | 14.3|   8| 360.0| 245| 3.21| 3.570| 15.84|  0|  0|    3|    4|
    |Merc 240D         | 24.4|   4| 146.7|  62| 3.69| 3.190| 20.00|  1|  0|    4|    2|
    |Merc 230          | 22.8|   4| 140.8|  95| 3.92| 3.150| 22.90|  1|  0|    4|    2|
    |Merc 280          | 19.2|   6| 167.6| 123| 3.92| 3.440| 18.30|  1|  0|    4|    4|
    
    ```r
    fread('mtcars.csv.gz') 
    ```
    
    
    
    |V1                |  mpg| cyl|  disp|  hp| drat|    wt|  qsec| vs| am| gear| carb|
    |:-----------------|----:|---:|-----:|---:|----:|-----:|-----:|--:|--:|----:|----:|
    |Mazda RX4         | 21.0|   6| 160.0| 110| 3.90| 2.620| 16.46|  0|  1|    4|    4|
    |Mazda RX4 Wag     | 21.0|   6| 160.0| 110| 3.90| 2.875| 17.02|  0|  1|    4|    4|
    |Datsun 710        | 22.8|   4| 108.0|  93| 3.85| 2.320| 18.61|  1|  1|    4|    1|
    |Hornet 4 Drive    | 21.4|   6| 258.0| 110| 3.08| 3.215| 19.44|  1|  0|    3|    1|
    |Hornet Sportabout | 18.7|   8| 360.0| 175| 3.15| 3.440| 17.02|  0|  0|    3|    2|
    |Valiant           | 18.1|   6| 225.0| 105| 2.76| 3.460| 20.22|  1|  0|    3|    1|
    |Duster 360        | 14.3|   8| 360.0| 245| 3.21| 3.570| 15.84|  0|  0|    3|    4|
    |Merc 240D         | 24.4|   4| 146.7|  62| 3.69| 3.190| 20.00|  1|  0|    4|    2|
    |Merc 230          | 22.8|   4| 140.8|  95| 3.92| 3.150| 22.90|  1|  0|    4|    2|
    |Merc 280          | 19.2|   6| 167.6| 123| 3.92| 3.440| 18.30|  1|  0|    4|    4|

3. bash的grep
    
    ```r
    fread('grep Merc mtcars.csv' )  
    ```
    
    
    
    |V1        |   V2| V3|    V4|  V5|   V6|   V7|   V8| V9| V10| V11| V12|
    |:---------|----:|--:|-----:|---:|----:|----:|----:|--:|---:|---:|---:|
    |Merc 240D | 24.4|  4| 146.7|  62| 3.69| 3.19| 20.0|  1|   0|   4|   2|
    |Merc 230  | 22.8|  4| 140.8|  95| 3.92| 3.15| 22.9|  1|   0|   4|   2|
    |Merc 280  | 19.2|  6| 167.6| 123| 3.92| 3.44| 18.3|  1|   0|   4|   4|

4. 远程网站上的数据
    
    ```r
    fread('https://picgo.vercel.app/mtcars.csv')  
    ```
    
    
    
    |V1                |  mpg| cyl|  disp|  hp| drat|    wt|  qsec| vs| am| gear| carb|
    |:-----------------|----:|---:|-----:|---:|----:|-----:|-----:|--:|--:|----:|----:|
    |Mazda RX4         | 21.0|   6| 160.0| 110| 3.90| 2.620| 16.46|  0|  1|    4|    4|
    |Mazda RX4 Wag     | 21.0|   6| 160.0| 110| 3.90| 2.875| 17.02|  0|  1|    4|    4|
    |Datsun 710        | 22.8|   4| 108.0|  93| 3.85| 2.320| 18.61|  1|  1|    4|    1|
    |Hornet 4 Drive    | 21.4|   6| 258.0| 110| 3.08| 3.215| 19.44|  1|  0|    3|    1|
    |Hornet Sportabout | 18.7|   8| 360.0| 175| 3.15| 3.440| 17.02|  0|  0|    3|    2|
    |Valiant           | 18.1|   6| 225.0| 105| 2.76| 3.460| 20.22|  1|  0|    3|    1|
    |Duster 360        | 14.3|   8| 360.0| 245| 3.21| 3.570| 15.84|  0|  0|    3|    4|
    |Merc 240D         | 24.4|   4| 146.7|  62| 3.69| 3.190| 20.00|  1|  0|    4|    2|
    |Merc 230          | 22.8|   4| 140.8|  95| 3.92| 3.150| 22.90|  1|  0|    4|    2|
    |Merc 280          | 19.2|   6| 167.6| 123| 3.92| 3.440| 18.30|  1|  0|    4|    4|



## 一些参数
1. fill
    
    ```r
    fread("A,B\n1,3\n2,4\n,5\n3\n")  
    ```
    
    ```
      Warning in fread("A,B\n1,3\n2,4\n,5\n3\n"): Discarded single-line footer: <<3>>
    ```
    
    
    
    |  A|  B|
    |--:|--:|
    |  1|  3|
    |  2|  4|
    | NA|  5|
    
    ```r
    fread("A,B\n1,3\n2,4\n,5\n3\n",fill=T)  
    ```
    
    
    
    |  A|  B|
    |--:|--:|
    |  1|  3|
    |  2|  4|
    | NA|  5|
    |  3| NA|

1. select 用法
    
    ```r
    fread('mtcars.csv', select = 1:4 )  
    ```
    
    
    
    |V1                |  mpg| cyl|  disp|
    |:-----------------|----:|---:|-----:|
    |Mazda RX4         | 21.0|   6| 160.0|
    |Mazda RX4 Wag     | 21.0|   6| 160.0|
    |Datsun 710        | 22.8|   4| 108.0|
    |Hornet 4 Drive    | 21.4|   6| 258.0|
    |Hornet Sportabout | 18.7|   8| 360.0|
    |Valiant           | 18.1|   6| 225.0|
    |Duster 360        | 14.3|   8| 360.0|
    |Merc 240D         | 24.4|   4| 146.7|
    |Merc 230          | 22.8|   4| 140.8|
    |Merc 280          | 19.2|   6| 167.6|
    
    ```r
    fread('mtcars.csv', select = c('V1', 'mpg',"cyl","disp" ))  
    ```
    
    
    
    |V1                |  mpg| cyl|  disp|
    |:-----------------|----:|---:|-----:|
    |Mazda RX4         | 21.0|   6| 160.0|
    |Mazda RX4 Wag     | 21.0|   6| 160.0|
    |Datsun 710        | 22.8|   4| 108.0|
    |Hornet 4 Drive    | 21.4|   6| 258.0|
    |Hornet Sportabout | 18.7|   8| 360.0|
    |Valiant           | 18.1|   6| 225.0|
    |Duster 360        | 14.3|   8| 360.0|
    |Merc 240D         | 24.4|   4| 146.7|
    |Merc 230          | 22.8|   4| 140.8|
    |Merc 280          | 19.2|   6| 167.6|
2. skip用法, skip为数字跳过n行，skip为string则跳至包含string的行
   
   ```r
   fread('mtcars.csv', skip = 4 )  
   ```
   
   
   
   |V1                |   V2| V3|    V4|  V5|   V6|    V7|    V8| V9| V10| V11| V12|
   |:-----------------|----:|--:|-----:|---:|----:|-----:|-----:|--:|---:|---:|---:|
   |Hornet 4 Drive    | 21.4|  6| 258.0| 110| 3.08| 3.215| 19.44|  1|   0|   3|   1|
   |Hornet Sportabout | 18.7|  8| 360.0| 175| 3.15| 3.440| 17.02|  0|   0|   3|   2|
   |Valiant           | 18.1|  6| 225.0| 105| 2.76| 3.460| 20.22|  1|   0|   3|   1|
   |Duster 360        | 14.3|  8| 360.0| 245| 3.21| 3.570| 15.84|  0|   0|   3|   4|
   |Merc 240D         | 24.4|  4| 146.7|  62| 3.69| 3.190| 20.00|  1|   0|   4|   2|
   |Merc 230          | 22.8|  4| 140.8|  95| 3.92| 3.150| 22.90|  1|   0|   4|   2|
   |Merc 280          | 19.2|  6| 167.6| 123| 3.92| 3.440| 18.30|  1|   0|   4|   4|
   
   ```r
   fread('mtcars.csv', skip = 'Hornet' )  
   ```
   
   
   
   |V1                |   V2| V3|    V4|  V5|   V6|    V7|    V8| V9| V10| V11| V12|
   |:-----------------|----:|--:|-----:|---:|----:|-----:|-----:|--:|---:|---:|---:|
   |Hornet 4 Drive    | 21.4|  6| 258.0| 110| 3.08| 3.215| 19.44|  1|   0|   3|   1|
   |Hornet Sportabout | 18.7|  8| 360.0| 175| 3.15| 3.440| 17.02|  0|   0|   3|   2|
   |Valiant           | 18.1|  6| 225.0| 105| 2.76| 3.460| 20.22|  1|   0|   3|   1|
   |Duster 360        | 14.3|  8| 360.0| 245| 3.21| 3.570| 15.84|  0|   0|   3|   4|
   |Merc 240D         | 24.4|  4| 146.7|  62| 3.69| 3.190| 20.00|  1|   0|   4|   2|
   |Merc 230          | 22.8|  4| 140.8|  95| 3.92| 3.150| 22.90|  1|   0|   4|   2|
   |Merc 280          | 19.2|  6| 167.6| 123| 3.92| 3.440| 18.30|  1|   0|   4|   4|


3. na.strings 空白字符串转化为 `NA`
    
    ```r
    fread('mtcar.blank.txt')  
    ```
    
    
    
    | V1|V2 | V3|
    |--:|:--|--:|
    |  1|   |  3|
    |  1|B  |  3|
    
    ```r
    fread('mtcar.blank.txt',na.strings = "")  
    ```
    
    
    
    | V1|V2 | V3|
    |--:|:--|--:|
    |  1|NA |  3|
    |  1|B  |  3|

4. colClasses, 如将列转化为字符串
   
   ```r
   fread('mtcars.csv', colClasses= list(character='cyl') )  
   ```
   
   
   
   |V1                |  mpg|cyl |  disp|  hp| drat|    wt|  qsec| vs| am| gear| carb|
   |:-----------------|----:|:---|-----:|---:|----:|-----:|-----:|--:|--:|----:|----:|
   |Mazda RX4         | 21.0|6   | 160.0| 110| 3.90| 2.620| 16.46|  0|  1|    4|    4|
   |Mazda RX4 Wag     | 21.0|6   | 160.0| 110| 3.90| 2.875| 17.02|  0|  1|    4|    4|
   |Datsun 710        | 22.8|4   | 108.0|  93| 3.85| 2.320| 18.61|  1|  1|    4|    1|
   |Hornet 4 Drive    | 21.4|6   | 258.0| 110| 3.08| 3.215| 19.44|  1|  0|    3|    1|
   |Hornet Sportabout | 18.7|8   | 360.0| 175| 3.15| 3.440| 17.02|  0|  0|    3|    2|
   |Valiant           | 18.1|6   | 225.0| 105| 2.76| 3.460| 20.22|  1|  0|    3|    1|
   |Duster 360        | 14.3|8   | 360.0| 245| 3.21| 3.570| 15.84|  0|  0|    3|    4|
   |Merc 240D         | 24.4|4   | 146.7|  62| 3.69| 3.190| 20.00|  1|  0|    4|    2|
   |Merc 230          | 22.8|4   | 140.8|  95| 3.92| 3.150| 22.90|  1|  0|    4|    2|
   |Merc 280          | 19.2|6   | 167.6| 123| 3.92| 3.440| 18.30|  1|  0|    4|    4|
